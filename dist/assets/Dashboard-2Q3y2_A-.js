import{j as e,_,Z as f,C as R,e as u,$ as P,a0 as S,q as D}from"./ui-vendor-eBBau3_-.js";import{d as E,r as i,L as j}from"./react-vendor-ClBxwFoA.js";import{u as M}from"./index-DZmIGIg5.js";import{S as T}from"./constants-v-3kMaWm.js";import"./store-vendor-CJ7bJ5Yt.js";const I=()=>{const{user:a,credits:k,isPro:r,logout:y,togglePro:$,refreshCredits:l}=M(),o=E(),[d,N]=i.useState(null),[v,n]=i.useState("");i.useEffect(()=>{a?(l(),b()):o("/login")},[a,o,l]);const b=async()=>{if(a)try{const{data:s,error:c}=await supabase.from("profiles").select("last_credit_reset, created_at").eq("id",a.id).single();if(!c&&s){const x=s.last_credit_reset?new Date(s.last_credit_reset):new Date(s.created_at),t=new Date(x);t.setMonth(t.getMonth()+1),N(t)}}catch(s){console.error("Erreur chargement date reset:",s)}};if(i.useEffect(()=>{if(!d)return;const s=()=>{const x=new Date,t=d.getTime()-x.getTime();if(t<=0){n("Recharge disponible !"),l(),b();return}const g=Math.floor(t/(1e3*60*60*24)),m=Math.floor(t%(1e3*60*60*24)/(1e3*60*60)),h=Math.floor(t%(1e3*60*60)/(1e3*60)),p=Math.floor(t%(1e3*60)/1e3);g>0?n(`${g}j ${m}h ${h}m`):m>0?n(`${m}h ${h}m ${p}s`):n(`${h}m ${p}s`)};s();const c=setInterval(s,1e3);return()=>clearInterval(c)},[d,l]),!a)return null;const w=()=>{const s=T.stripe.customerPortal;s.includes("votre_portail")?alert("Le portail client Stripe n'est pas encore configuré. Veuillez configurer REACT_APP_STRIPE_PORTAL dans vos variables d'environnement."):window.location.href=s};return e.jsxs("div",{className:"max-w-5xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end mb-12 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-display text-4xl md:text-5xl font-bold dark:text-white mb-2",children:"Mon Espace"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 text-lg",children:["Heureux de vous revoir, ",e.jsx("span",{className:"font-bold text-black dark:text-white",children:a.email.split("@")[0]}),"."]})]}),e.jsxs("button",{onClick:()=>{y(),o("/")},className:"px-4 py-2 border-2 border-black dark:border-gray-500 rounded-md hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 font-bold text-sm flex items-center gap-2 transition-colors",children:[e.jsx(_,{className:"w-4 h-4"})," Se déconnecter"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-12",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border-2 border-black dark:border-gray-500 rounded-lg p-6 shadow-neo dark:shadow-none relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx(f,{className:"w-32 h-32 text-neo-orange"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-gray-500 dark:text-gray-400 font-bold uppercase tracking-wider text-xs",children:[e.jsx(f,{className:"w-4 h-4"})," Solde Disponible"]}),e.jsx("div",{className:"font-display text-6xl font-bold mb-6 dark:text-white",children:k}),e.jsx("div",{className:"flex gap-3",children:e.jsx(j,{to:"/pricing",className:"flex-1 py-3 bg-neo-black dark:bg-white text-white dark:text-black font-bold text-center rounded-md shadow-[3px_3px_0px_0px_#fdba74] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all",children:"Acheter des crédits"})}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-400",children:r?"Abonnement PRO actif.":"Passez PRO pour obtenir 100 crédits/mois."}),d&&e.jsxs("div",{className:"flex items-center gap-2 text-xs bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600",children:[e.jsx(R,{className:"w-3 h-3 text-neo-orange"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-bold",children:"Prochaine recharge :"})," ",v]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-auto",children:["(",r?"100":"5"," crédits)"]})]})]})]})]}),e.jsxs("div",{className:`border-2 border-black dark:border-gray-500 rounded-lg p-6 shadow-neo dark:shadow-none relative overflow-hidden ${r?"bg-neo-violet text-black":"bg-white dark:bg-gray-800 dark:text-white"}`,children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx(u,{className:"w-32 h-32 text-white dark:text-gray-500"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 font-bold uppercase tracking-wider text-xs opacity-70",children:[e.jsx(u,{className:"w-4 h-4"})," Mon Plan"]}),e.jsx("div",{className:"font-display text-6xl font-bold mb-2",children:r?"PRO":"Gratuit"}),e.jsx("div",{className:"mb-6 text-sm font-medium opacity-80",children:r?"Abonnement actif.":"Fonctionnalités limitées."}),e.jsx("div",{className:"flex gap-3",children:r?e.jsx("button",{onClick:w,className:"flex-1 py-3 bg-white text-black font-bold border-2 border-black rounded-md hover:bg-gray-100 transition-colors",children:"Gérer l'abonnement / Résilier"}):e.jsx(j,{to:"/pricing",className:"flex-1 py-3 bg-neo-black dark:bg-white text-white dark:text-black font-bold text-center rounded-md shadow-[3px_3px_0px_0px_#fff] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all",children:"Passer PRO (9.99€)"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 border-2 border-black dark:border-gray-600 rounded-lg p-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2 dark:text-white",children:[e.jsx(P,{className:"w-5 h-5"})," Détails du compte"]}),e.jsxs("ul",{className:"space-y-3 text-sm",children:[e.jsxs("li",{className:"flex justify-between dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-500",children:"Email"}),e.jsx("span",{className:"font-bold",children:a.email})]}),e.jsxs("li",{className:"flex justify-between dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-500",children:"ID Membre"}),e.jsxs("span",{className:"font-mono text-xs bg-gray-200 dark:bg-gray-800 px-2 py-0.5 rounded",children:["#",a.id.substring(0,8)]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-gray-800 border-2 border-black dark:border-gray-600 rounded-lg p-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-6 flex items-center gap-2 dark:text-white",children:[e.jsx(S,{className:"w-5 h-5"})," Activité"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm italic",children:"L'historique détaillé des générations sera bientôt disponible."})]})]}),e.jsxs("div",{className:"mt-8 p-4 bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-200 dark:border-blue-800 rounded-md flex gap-4 items-start",children:[e.jsx(D,{className:"w-6 h-6 text-blue-600 dark:text-blue-400 shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-blue-800 dark:text-blue-300 text-sm",children:"Besoin d'une facture ?"}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:"Les factures sont envoyées automatiquement par Stripe à votre adresse email lors de chaque paiement. Vérifiez vos spams ou contactez le support."})]})]})]})};export{I as Dashboard};
